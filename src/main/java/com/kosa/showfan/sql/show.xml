<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kosa.show.ShowMapper">
	<select id="selectById"
		resultType="com.kosa.showfan.show.dto.showAllInfoDTO"
		parameterType="java.util.List">
		    select *
		from show a
		left join seat c on (a.show_id = c.show_id)
        left join cast d on (a.show_id = d.show_id)
		left join artist e on ( d.artist_id = e.artist_id)
		where a.show_id = #{asd}
	</select>

	<select id="selectByConcept"
		resultType="com.kosa.showfan.show.dto.ShowDTO"
		parameterType="java.util.List">
		SELECT * FROM SHOW WHERE GENRE_ID = #{GENRE}
	</select>
	
	<select id="selectByName"
		resultType="String">
		SELECT SHOW_ID FROM SHOW WHERE show_name = #{show_name}
	</select>
	
	<select id="selectAll"
		resultType="com.kosa.showfan.show.dto.ShowDTO"
		parameterType="java.util.List">
		SELECT * FROM SHOW ORDER BY SHOW_START_DAY DESC
		,GENRE_ID ASC
	</select>

	<select id="selectByString" resultType="ShowSearchDTO">
		SELECT s.show_id,
		s.show_poster, s.genre_id, s.show_name, s.show_venues,
		TO_CHAR(s.show_start_day, 'yyyy.mm.dd') show_start_day,
		TO_CHAR(s.show_end_day, 'yyyy.mm.dd') show_end_day, s.show_address,
		s.show_status, NVL(r.c, 0) review_cnt, NVL(r.a, 0) grade_avg
		FROM show
		s LEFT JOIN (SELECT show_id, COUNT(*) c, AVG(review_grade) a
		FROM
		review
		GROUP BY show_id) r ON s.show_id = r.show_id
		WHERE
		INSTR(s.show_name, #{value}) !=0
		ORDER BY show_end_day DESC
	</select>

	<select id="selectByDate" resultType="showCalendarDTO"
		parameterType="hashmap">
		SELECT show_id, genre_id, show_name, show_venues,
		show_address, show_start_day, show_end_day
		FROM show
	</select>
</mapper>